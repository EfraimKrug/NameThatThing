<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanks!</title>
    <link rel="stylesheet" href="css/foundation.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/yahrzeit.css">
    <script src="js/formatData.js"></script>
    <script src="js/dataBase.js"></script>
    <script src="js/cookieControl.js"></script>
    <script src="js/doMail.js"></script>
  </head>
<body>
<div class="grid-container">

  <div class="grid-x grid-padding-x">
    <div class="large-12 cell">
      <h1><font color=#f98e3f>&nbsp;</font></h1>
    </div>
  </div>

  <div class="grid-x grid-padding-x">
    <div class="large-8 medium-8 cell">
      <div class="grid-x grid-padding-x">
          <div class="large-4 medium-4 small-4 cell">
            <div class=RequestList>
              Thank you, <span id=fname></span>,
              <p><br>You have donated <span id=donation></span> to <span id=place></span>
              in honor of <span id=yname></span><br>[Yahrzeit: <span id=hdate></span>].</p>
            </div>
          </div>
        </div>  <!-- here -->
       </div>
  </div>
</div>
<div id=output></div>
<div id=output2></div>
<div id=output3></div>
<div id=output4></div>
</body>
<script src="js/yahrzeit.js?v2"></script>
<script>

function sendMail2(){
  var OData = JSON.parse(document.getElementById("output2").innerHTML);
  var PData = JSON.parse(document.getElementById("output3").innerHTML);
  var req = document.getElementById("output4").innerHTML;
  // console.log('sending email - 2');
  doMail("ThanksPerson", PData[0]['EMail'], PData[0]['FName'], req);
}

function sendMail(){
  var OData = JSON.parse(document.getElementById("output2").innerHTML);
  var PData = JSON.parse(document.getElementById("output3").innerHTML);
  var req = document.getElementById("output4").innerHTML;
  // console.log('sending email - 1');
  doMail("OrgSchedule", OData['OEmail'], OData['ORav'], req, sendMail2);
}

function fillPage(){
  var YData = JSON.parse(document.getElementById("output").innerHTML);
  var OData = JSON.parse(document.getElementById("output2").innerHTML);
  var PData = JSON.parse(document.getElementById("output3").innerHTML);

  var donation = document.getElementById("donation");
  var place = document.getElementById("place");
  var yname = document.getElementById("yname");
  var fname = document.getElementById("fname");
  var hdate = document.getElementById("hdate");

  donation.innerHTML = "$" + amount;
  place.innerHTML = OData['OName'];
  yname.innerHTML = YData['YName'];
  fname.innerHTML = PData[0]['FName'];
  hdate.innerHTML = YData['YHDay'] + ", " + YData['YHMonth'];
  sendMail();
}

function getOrg (){
  dbOrgs("select", output2, 'X', 'Y', [oid, '', '', '', '', '', '', '', '', '', ''], fillPage);
}

function getPeople (){
  dbPeople("select", output3, 'X', 'Y', [pid, '', '', '', '', '', '', ''], getOrg);

}


function dbAccess(){
  // console.log("dbAccess");
  // alert("just into dbAccess");
  var logon = JSON.parse(document.getElementById("output").innerHTML);
  LOGON_OK = logon.RETURN;
  if(LOGON_OK.search("TRUE") > -1){
    LOGON_PID = logon.PID;
    FIRST_ENTRY = false;
    // alert("before all");
    var paidDate = getCurrentDate();
    dbRequests("insert", output4, X, Y, [0, pid, type, '', amount, paidDate,  '', '', '', '', oid, yid], function(){});
    dbYahrzeits("select", output, 'X', 'Y', [yid, '', '', '', '', '', '', ''], getPeople);
  }
}

// function dbAccess(){
//   console.log("dbAccess");
//   // if(rid)
//   dbRequests("select", output4, X, Y, [rid, '', '', '', '', '',  '', '', '', '', '', ''], init2);
//   // else
//     // init2();
// }

var amount = getUrlVars()["AMOUNT"];
var pid = getUrlVars()["PID"];
var oid = getUrlVars()["OID"];
// var rid = getUrlVars()["RID"];
var yid = getUrlVars()["YahrID"];
var X = getUrlVars()["X"];
var Y = getUrlVars()["Y"];
var type = getUrlVars()["type"];

// function init2(){
//   // console.log("init2");
//   var logon = JSON.parse(document.getElementById("output").innerHTML);
//   // if(rid){
//   // var RData = JSON.parse(document.getElementById("output4").innerHTML);
//   // console.log("=====>>>>>>>>>");
//   // console.log(document.getElementById("output4").innerHTML);
//   // RData['ReqType'] = type;
//   // RData['ReqOID'] = oid;
//   // RData['ReqAmount'] = amount;
//   // RData['ReqYID'] = yid;
//       // console.log(RData);
//   // }
//   LOGON_OK = logon.RETURN;
//   if(LOGON_OK.search("TRUE") > -1){
//     LOGON_PID = logon.PID;
//     FIRST_ENTRY = false;
//     // if(rid)
//     // dbRequests("update", output4, X, Y, RData, dbAccess2);
//     // else
//     dbRequests("insert", output4, X, Y, [0, pid, type, '', amount, '',  '', '', '', '', oid, yid], function(){});
//   }
// }

function init(){
    // console.log("init");
    checkLogin("paid", [pid, oid, yid, amount, X, Y]);
}

init();
</script>
<script src="js/escape.js"></script>
<script src="js/vendor/jquery.js"></script>
<script src="js/vendor/what-input.js"></script>
<script src="js/vendor/foundation.js"></script>
<script src="js/app.js"></script>
</html>
